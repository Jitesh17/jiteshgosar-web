---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog")).filter((p) => !p.data.draft);

const tagCounts = new Map<string, number>();
for (const p of posts) {
  for (const t of p.data.tags ?? []) {
    const tag = String(t);
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  }
}

const tags = Array.from(tagCounts.entries()).sort((a, b) => a[0].localeCompare(b[0]));
---
<BaseLayout title="Tags" description="Browse posts by topic.">
  <main class="mx-auto max-w-6xl px-4 py-12">
    <h1 class="text-4xl font-semibold tracking-tight">Tags</h1>
    <p class="mt-3 max-w-2xl text-base leading-7 text-neutral-700 dark:text-neutral-300">
      Browse posts by topic.
    </p>

    <div class="mt-8 flex flex-wrap gap-2">
      {tags.map(([tag, count]) => (
        <a
          class="rounded-full border border-neutral-200 px-3 py-1.5 text-sm text-neutral-700 transition hover:bg-neutral-50
                 dark:border-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-900"
          href={`/tags/${encodeURIComponent(tag)}/`}
        >
          {tag} <span class="text-neutral-500">({count})</span>
        </a>
      ))}
    </div>
  </main>
</BaseLayout>
