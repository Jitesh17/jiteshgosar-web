---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog")).filter((p) => !p.data.draft);

const tagCounts = new Map<string, number>();
for (const p of posts) {
  for (const t of p.data.tags ?? []) {
    const tag = String(t);
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  }
}

const tags = Array.from(tagCounts.entries()).sort((a, b) => a[0].localeCompare(b[0]));
---

<BaseLayout title="Tags" description="Browse posts by topic.">
  <div class="relative mx-auto min-h-screen max-w-6xl px-4 py-12 lg:py-24 bg-neutral-50 dark:bg-neutral-950 transition-colors duration-300">
    
    <main>
      <header class="mb-12">
        <h1 class="text-4xl font-bold tracking-tight text-neutral-900 dark:text-white">Tags</h1>
        <p class="mt-4 text-lg leading-8 text-neutral-600 dark:text-neutral-400">
          Browse the journal by topic and interest.
        </p>
      </header>

      <div class="mt-8 flex flex-wrap gap-3">
        {tags.map(([tag, count]) => (
          <a
            href={`/tags/${encodeURIComponent(tag)}/`}
            class="group flex items-center gap-2 rounded-full border px-4 py-2 text-sm transition-all duration-300
                   border-neutral-200 bg-white text-neutral-600 hover:border-neutral-300 hover:text-neutral-900 hover:shadow-sm
                   dark:border-neutral-800 dark:bg-neutral-900/40 dark:text-neutral-400 dark:hover:border-neutral-700 dark:hover:bg-neutral-900 dark:hover:text-neutral-200"
          >
            <span class="font-medium">#{tag}</span>
            <span class="text-xs text-neutral-400 group-hover:text-neutral-500 dark:text-neutral-600 dark:group-hover:text-neutral-500">
              {count}
            </span>
          </a>
        ))}
      </div>
    </main>
    
  </div>
</BaseLayout>